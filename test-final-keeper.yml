---
- name: Final Test - Complete Keeper Setup
  hosts: 127.0.0.1
  connection: local
  gather_facts: false
  collections:
    - keepersecurity.keeper_secrets_manager

  pre_tasks:
    - name: Install Keeper SDK (runtime method)
      pip:
        name:
          - keeper-secrets-manager-core
          - keeper-secrets-manager-ansible
        state: present
        executable: pip3
      delegate_to: localhost
      run_once: true

  tasks:
    - name: âœ… Test Keeper Info
      keeper_info:
      register: keeper_info
      failed_when: false

    - name: Show results
      debug:
        msg:
          - "âœ… Collection: Working from project structure"
          - "âœ… SDK: Installed at runtime"
          - "âœ… Module: {{ 'SUCCESS' if keeper_info.failed is false else 'FAILED - ' + keeper_info.msg | default('Unknown error') }}"
          - ""
          - "ðŸŽ‰ Your Keeper Secrets Manager collection is ready!"

    - name: Next steps
      debug:
        msg:
          - "To use in production:"
          - "1. Add your Keeper config as credentials in AAP"
          - "2. Reference real secret UIDs in keeper_get tasks"
          - "3. Use the runtime pip install pattern in all Keeper playbooks"